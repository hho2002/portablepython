jobs:
- job: build

  strategy:
    matrix:
      PY377_32:
        PYVERSION: 3.7.9
        PYARCH: 32
      PY377_64:
        PYVERSION: 3.7.9
        PYARCH: 64

      PY383_32:
        PYVERSION: 3.8.5
        PYARCH: 32
      PY383_64:
        PYVERSION: 3.8.5
        PYARCH: 64

#      PY2718_32:
#        PYVERSION: 2.7.18
#        PYARCH: 32
#      PY2718_64:
#        PYVERSION: 2.7.18
#        PYARCH: 64

  pool:
    vmImage: 'vs2017-win2016'

  steps:
  - powershell: .\download.ps1
    displayName: 'Run the build'

  - task: PublishPipelineArtifact@0
    inputs:
      targetPath: 'install.log'
      artifactName: '$(PYVERSION)-$(PYARCH)-install.log'

  - task: ArchiveFiles@2
    inputs:
      rootFolderOrFile: 'Python-$(PYVERSION)-$(PYARCH)'
      archiveType: 'zip'
      archiveFile: '$(Build.ArtifactStagingDirectory)/Python-$(PYVERSION)-$(PYARCH).zip'

  - task: PublishPipelineArtifact@0
    inputs:
      targetPath: '$(Build.ArtifactStagingDirectory)/Python-$(PYVERSION)-$(PYARCH).zip'
      artifactName: '$(PYVERSION)-$(PYARCH)'

- job: release
  dependsOn: build
  condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/master'))
  pool:
    vmImage: 'vs2017-win2016'
  steps:
  - task: DownloadPipelineArtifact@1

  - task: GithubRelease@0
    inputs:
      githubConnection: 'hho2002pat'
      assets: '$(System.ArtifactsDirectory)/**/*.zip'
